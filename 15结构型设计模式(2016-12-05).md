# 结构型设计模式(2016/12/05)

标签（空格分隔）： 前端 js

---

> 今天是结构型设计模式的其余部分。137页~153页。

### **结构型设计模式**
#### **5. 享元模式**
#### **6. 掺合模式**
#### **7. 模块模式**
#### **8. 代理模式**
> **代理模式**：通过定义一个代理对象或者方法来替换或增强一个已经存在的对象或方法，以提升其性能或增加额外的功能，但是又不影响已经使用了该对象或方法的其余部分代码。

- 代理模式：
```
//对myData.cookies.get()方法实现代理，先把当前方法保存在一个变量中
var proxiedGet = myData.cookies.get;

//使用一个新的函数来重写get()方法，对原来的方法实现代理并增加它的行为
myData.cookies.get = function(){

	//调用被代理的方法来获取它可能产生的值
	var value = proxiedGet.apply(this, arguments);

	value = value.toUpperCase();

	//对于实施了某种操作后的值，类型要与被代理方法相同。
	//使用该值作为返回值，则新方法的使用不会影响到原有的对该方法的调用
	
	return value;
}
```

- 虚拟代理模式：
```
//定义一个类，用于构建一个对象，来表示一个简单表单域
function FormField(type, displayText){
	this.type = type || 'text';
	this.displayText = displayText || '';

	//创建并初始化一个表单域DOM元素
	this.element = document.createElement('input');
	this.element.setAttribute('type', this.type);
	this.element.setAttribute('placeholder', this.displayText);
}

FormField.prototype = {
	getElement: function(){
		return this.element;
	},
	isValid: function(){
		return this.element.value !== '';
	}
};

//现在使用相同的方法代理来替换FormField类。它会延迟调用原来的构造函数，直至这些方法被真正调用。这样节省了内存资源并提高了性能
//根据需要，可使用模块模式来使该代理类的作用域实现局部化，传入原来的FormField类并返回它所经过代理的版本
FormField = (function(FormField){

	//定义代理构造函数
	function FormFieldProxy(type, displayText){
		this.type = type;
		this.displayText = displayText;
	}

	FormFieldProxy.prototype = {
		//定义一个属性，用于在原来的类被实例化之后，保存对该实例的引用
		formField: null,

		initialize: function(){
			if(!this.formField){
				this.formField = new FormField(this.type, this.displayText);
			}
		},

		//使用一些新的方法对原来的各个方法进行代理
		//只有当这些新方法当中某一个被调用时，才会调用initialize()方法来实例化
		getElement: function(){
			this.initialize();
			return this.formField.getElement();
		},

		isValid: function(){
			this.initialize();
			return this.formField.isValid();
		}
	};

	return FormFieldProxy;
}(formField));

//创建实例对象，它们实际调用的都是代理类而不是原来的类。
//这意味着，在此阶段DOM元素并没有创建，节省了内存，提高了性能。
var emailField = new FormField('email', '这是一个邮箱表单域');

window.addEventListener('load', function(){
	document.body.appendChild(emailField.getElement());
}, false);
```



